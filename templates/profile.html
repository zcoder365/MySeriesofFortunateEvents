{% extends "base.html" %}
{% block content %}

<div class="profile-info">
    <div class="profile-info-username">
        <p>Username:</p>
        <p>{{ username }}</p>
    </div>
    <div class="profile-info-streak">
        <p>Current Streak:</p>
        <p>{{ streak }}</p>
    </div>
    <div class="profile-info-entries">
        <p>Total Entries:</p>
        <p>{{ num_entries }}</p>
    </div>
    <div class="profile-info-reset">
        <a href="{{ url_for('reset_password') }}"><button class="reset-btn">Reset Password</button></a>
    </div>
</div>

<!-- Yearly Review Chart - Should be OUTSIDE and ABOVE the charts-container -->
<div class="yearly-review-container">
    <div class="yearly-chart-block">
        <h3 style="text-align:center;">📊 {{ current_year }} Yearly Review</h3>
        <canvas id="ratingsChartYearly" aria-label="Bar chart showing average ratings by month for the year" role="img"></canvas>
        <div class="yearly-stats-block">
            <h4 style="margin-top:30px;">{{ current_year }} Annual Statistics</h4>
            <table class="yearly-stats-table">
                <tr>
                    <th>📈 Average Rating</th>
                    <td>{{ yearly_avg_rating }}</td>
                </tr>
                <tr>
                    <th>🏆 Highest Month</th>
                    <td>{{ yearly_max_rating }}</td>
                </tr>
                <tr>
                    <th>📉 Lowest Month</th>
                    <td>{{ yearly_min_rating }}</td>
                </tr>
                <tr>
                    <th>📝 Total Entries</th>
                    <td>{{ yearly_total_entries }}</td>
                </tr>
            </table>
        </div>
    </div>
</div>

<div class="charts-container">
    <!-- All Time Chart -->
    <div class="chart-block">
        <h3 style="text-align:center;">All Time Rating Distribution</h3>
        <canvas id="ratingsChartAll" aria-label="Bar chart of all entry ratings distribution" role="img"></canvas>
        <div class="stats-block">
            <h4 style="margin-top:30px;">All Time Stats</h4>
            <table class="stats-table">
                <tr>
                    <th>Average Rating</th>
                    <td>{{ all_avg_rating }}</td>
                </tr>
                <tr>
                    <th>Highest Rating</th>
                    <td>{{ all_max_rating }}</td>
                </tr>
                <tr>
                    <th>Lowest Rating</th>
                    <td>{{ all_min_rating }}</td>
                </tr>
                <tr>
                    <th>Total Entries</th>
                    <td>{{ all_total_entries }}</td>
                </tr>
            </table>
        </div>
    </div>
    
    <!-- Week Chart -->
    <div class="chart-block">
        <h3 style="text-align:center;">This Week's Ratings</h3>
        <canvas id="ratingsChart" aria-label="Bar chart of entry ratings" role="img"></canvas>
        <div class="stats-block">
            <h4 style="margin-top:30px;">This Week's Stats</h4>
            <table class="stats-table">
                <tr>
                    <th>Average Rating</th>
                    <td>{{ week_avg_rating }}</td>
                </tr>
                <tr>
                    <th>Highest Rating</th>
                    <td>{{ week_max_rating }}</td>
                </tr>
                <tr>
                    <th>Lowest Rating</th>
                    <td>{{ week_min_rating }}</td>
                </tr>
                <tr>
                    <th>Total Entries</th>
                    <td>{{ week_total_entries }}</td>
                </tr>
            </table>
        </div>
    </div>
    
    <!-- Month Chart -->
    <div class="chart-block">
        <h3 style="text-align:center;">This Month's Ratings</h3>
        <canvas id="ratingsChartMonth" aria-label="Bar chart of entry ratings for the month" role="img"></canvas>
        <div class="stats-block">
            <h4 style="margin-top:30px;">This Month's Stats</h4>
            <table class="stats-table">
                <tr>
                    <th>Average Rating</th>
                    <td>{{ month_avg_rating }}</td>
                </tr>
                <tr>
                    <th>Highest Rating</th>
                    <td>{{ month_max_rating }}</td>
                </tr>
                <tr>
                    <th>Lowest Rating</th>
                    <td>{{ month_min_rating }}</td>
                </tr>
                <tr>
                    <th>Total Entries</th>
                    <td>{{ month_total_entries }}</td>
                </tr>
            </table>
        </div>
    </div>
</div>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Pass data to JavaScript for all charts
    window.chartLabels = {{ chart_labels | tojson | safe }};
    window.chartData = {{ chart_data | tojson | safe }};
    window.chartLabelsMonth = {{ chart_labels_month | tojson | safe }};
    window.chartDataMonth = {{ chart_data_month | tojson | safe }};
    window.chartLabelsAll = {{ chart_labels_all | tojson | safe }};
    window.chartDataAll = {{ chart_data_all | tojson | safe }};
    window.chartLabelsYearly = {{ chart_labels_yearly | tojson | safe }};
    window.chartDataYearly = {{ chart_data_yearly | tojson | safe }};
    window.chartCountsYearly = {{ chart_counts_yearly | tojson | safe }};
</script>
<script src="{{ url_for('static', filename='ratingsChart.js') }}"></script>
<script src="{{ url_for('static', filename='ratingsChartMonth.js') }}"></script>
<script src="{{ url_for('static', filename='ratingsChartAll.js') }}"></script>
<script src="{{ url_for('static', filename='ratingsChartYearly.js') }}"></script>

{% endblock %}